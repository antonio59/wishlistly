{% extends "base.html" %}

{% block title %}Add Item to Wishlist{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Add Item to {{ wishlist.title }}</h2>
    <form method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
        <div class="mb-3">
            <label for="name" class="form-label">Item Name *</label>
            <input type="text" class="form-control" id="name" name="name" required
                   data-bs-toggle="tooltip" data-bs-placement="right" 
                   title="Enter the name of the item you want">
            <div class="invalid-feedback">
                Please provide an item name.
            </div>
        </div>
        
        <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            <textarea class="form-control" id="description" name="description" rows="3"
                      data-bs-toggle="tooltip" data-bs-placement="right" 
                      title="Add details about the item, such as color, size, or any specific preferences"></textarea>
        </div>
        
        <div class="mb-3">
            <label for="url" class="form-label">Link (Optional)</label>
            <input type="url" class="form-control" id="url" name="url" placeholder="https://example.com/item"
                   data-bs-toggle="tooltip" data-bs-placement="right" 
                   title="Add a link to where this item can be found online">
        </div>
        
        <div class="mb-3">
            <label for="images" class="form-label">Images (Max 2)</label>
            <input type="file" class="form-control" id="images" name="images" multiple accept="image/*"
                   data-bs-toggle="tooltip" data-bs-placement="right" 
                   title="Upload up to 2 images of the item. Each image must be under 16MB.">
            <div class="form-text">
                Supported formats: PNG, JPG, JPEG, GIF. Max size: 16MB per image.
                <br>
                Need to compress your images? Try these free services:
                <ul class="mt-1">
                    <li><a href="https://squoosh.app" target="_blank" rel="noopener noreferrer">Squoosh</a> - Browser-based, fast, and easy to use</li>
                    <li><a href="https://tinypng.com" target="_blank" rel="noopener noreferrer">TinyPNG</a> - Great for PNG and JPG compression</li>
                </ul>
            </div>
        </div>
        
        <div class="mb-3">
            <label for="priority" class="form-label">Priority</label>
            <select class="form-select" id="priority" name="priority"
                    data-bs-toggle="tooltip" data-bs-placement="right" 
                    title="HIGH: Must have! MEDIUM: Would really like. LOW: Nice to have.">
                <option value="LOW">Low Priority</option>
                <option value="MEDIUM" selected>Medium Priority</option>
                <option value="HIGH">High Priority</option>
            </select>
            <div class="form-text">
                <i class="fas fa-info-circle"></i> Priority levels:
                <ul class="mt-1">
                    <li><strong>High Priority:</strong> Must have! These are the items you want the most.</li>
                    <li><strong>Medium Priority:</strong> Would really like to have these items.</li>
                    <li><strong>Low Priority:</strong> Nice to have, but not essential.</li>
                </ul>
            </div>
        </div>
        
        <button type="submit" class="btn btn-primary">Add Item</button>
        <a href="{{ url_for('manage_wishlist', wishlist_id=wishlist.id) }}" class="btn btn-secondary">Cancel</a>
    </form>
</div>

<script>
// Initialize all tooltips
var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl)
});

// Form validation
(function() {
    'use strict';
    window.addEventListener('load', function() {
        var forms = document.getElementsByClassName('needs-validation');
        var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
                if (form.checkValidity() === false) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    }, false);
})();

// Image upload validation
document.getElementById('images').addEventListener('change', function(e) {
    const maxFiles = 2;
    const maxSize = 16 * 1024 * 1024; // 16MB in bytes
    
    if (this.files.length > maxFiles) {
        alert(`You can only upload up to ${maxFiles} images`);
        this.value = '';
        return;
    }
    
    // Check file sizes
    for (let i = 0; i < this.files.length; i++) {
        if (this.files[i].size > maxSize) {
            alert(`File "${this.files[i].name}" is too large. Maximum size is 16MB.\n\nTry using one of the recommended image compression tools below the upload field!`);
            this.value = '';
            return;
        }
    }
});
</script>
{% endblock %}
